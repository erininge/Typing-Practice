<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f14" />
  <title>Kana Keyboard Trainer</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="background-video" id="background-video" aria-hidden="true"></div>
  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">„Åã„Å™</div>
      <div>
        <div class="title">Kana Keyboard Trainer</div>
        <div class="subtitle">Memorize the Japanese Kana keyboard layout</div>
      </div>
    </div>
      <div class="meta">
        <span class="pill">v1.2.16</span>
        <span class="pill">sakura aura</span>
      </div>
  </header>

  <main class="container">
    <section class="card" id="home">
      <h2 class="section-title">Choose a mode</h2>
      <div class="badgeRow" aria-label="Study tags">
        <span class="badge">JLPT N5</span>
        <span class="badge">JLPT N4</span>
        <span class="badge">JLPT N3</span>
        <span class="badge">JLPT N2</span>
        <span class="badge">JLPT N1</span>
        <span class="badge">Lesson</span>
        <span class="badge">Section</span>
      </div>
      <div class="grid2">
        <button class="btn primary" data-nav="practice">Practice: Single Kana (Find the key)</button>
        <button class="btn" data-nav="word">Practice: Words</button>
        <button class="btn" data-nav="sentence">Practice: Sentences</button>
        <button class="btn" data-nav="typing">Typing Run (Kana stream)</button>
        <button class="btn" data-nav="stats">Stats</button>
        <button class="btn" data-nav="settings">Settings / Keyboard Map</button>
      </div>

      <div class="hint">
        <p><strong>How it works:</strong> by default this game listens for your <em>native keyboard input</em> (e.g., kana produced by your OS/IME). You can switch to physical-key mapping in Settings if you prefer training key positions directly.</p>
        <p class="small">Text-box modes (Typing/Words/Sentences) always use your normal typed characters. The <strong>Input mode</strong> setting only affects the single-kana practice mode.</p>
      </div>
    </section>

    <section class="card hidden" id="practice">
      <div class="row">
        <h2 class="section-title">Practice: Find the key</h2>
        <div class="row gap">
          <button class="btn" data-nav="home">Home</button>
          <button class="btn" id="btnPracticeStart">Start</button>
          <button class="btn" id="btnPracticePause" disabled>Pause</button>
          <button class="btn" id="btnPracticeStop" disabled>Stop</button>
        </div>
      </div>

      <div class="practicePanel">
        <div class="bigTarget" id="targetKana">‚Äî</div>
        <div class="sub" id="targetHint">Press the key for this kana</div>
        <div class="feedback" id="feedback"></div>

        <div class="scoreRow">
          <div class="statBox"><div class="k">Streak</div><div class="v" id="streak">0</div></div>
          <div class="statBox"><div class="k">Correct</div><div class="v" id="correct">0</div></div>
          <div class="statBox"><div class="k">Wrong</div><div class="v" id="wrong">0</div></div>
          <div class="statBox"><div class="k">Accuracy</div><div class="v" id="acc">‚Äî</div></div>
        </div>
      </div>

      <div class="kbdWrap">
        <div class="kbdHeader">
          <div>
            <div class="kbdTitle">On-screen keyboard</div>
            <div class="small muted">Target key highlights. Click ‚ÄúSettings‚Äù to edit the map if your stickers differ.</div>
          </div>
          <button class="btn smallBtn" data-nav="settings">Edit map</button>
        </div>
        <div class="kbdLegend" data-finger-guide>
          <div class="kbdLegendTitle">Finger guide</div>
          <div class="kbdLegendItems">
            <span class="legendItem finger-lp"><span class="legendDot"></span>Left pinky</span>
            <span class="legendItem finger-lr"><span class="legendDot"></span>Left ring</span>
            <span class="legendItem finger-lm"><span class="legendDot"></span>Left middle</span>
            <span class="legendItem finger-li"><span class="legendDot"></span>Left index</span>
            <span class="legendItem finger-ri"><span class="legendDot"></span>Right index</span>
            <span class="legendItem finger-rm"><span class="legendDot"></span>Right middle</span>
            <span class="legendItem finger-rr"><span class="legendDot"></span>Right ring</span>
            <span class="legendItem finger-rp"><span class="legendDot"></span>Right pinky</span>
            <span class="legendItem finger-th"><span class="legendDot"></span>Thumbs</span>
          </div>
          <div class="small muted">Home row: rest fingers on A S D F + J K L ; (bumps on F/J).</div>
        </div>
        <div id="keyboard" class="keyboard" aria-label="Keyboard"></div>
      </div>

      <div class="small muted">
        <p>Scoring saves automatically in your browser (localStorage). Use ‚ÄúReset stats‚Äù in Settings if you want a clean slate.</p>
      </div>
    </section>

    <section class="card hidden" id="typing">
      <div class="row">
        <h2 class="section-title">Typing Run: Kana stream</h2>
        <div class="row gap">
          <button class="btn" data-nav="home">Home</button>
          <button class="btn" id="btnTypingStart">Start</button>
          <button class="btn" id="btnTypingPause" disabled>Pause</button>
          <button class="btn" id="btnTypingStop" disabled>Stop</button>
        </div>
      </div>

      <div class="typingPanel">
        <div class="typingLine" id="typingTarget"></div>
        <div class="typingLine typed inputDisplay" id="typingTyped"></div>
        <input class="typingLine typed input typingInputField" id="typingInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Type here..." />
        <div class="small muted">Press Start to begin. The timer starts only after you press Start. Type in the box like a normal text field (your OS/IME input). Mistakes highlight in the passage.</div>

        <div class="kbdWrap kbdStartHidden" id="typingKeyboardWrap">
          <div class="kbdHeader">
            <div>
              <div class="kbdTitle">On-screen keyboard</div>
              <div class="small muted">Highlights the next key you need.</div>
            </div>
          </div>
          <div class="kbdLegend" data-finger-guide>
            <div class="kbdLegendTitle">Finger guide</div>
            <div class="kbdLegendItems">
              <span class="legendItem finger-lp"><span class="legendDot"></span>Left pinky</span>
              <span class="legendItem finger-lr"><span class="legendDot"></span>Left ring</span>
              <span class="legendItem finger-lm"><span class="legendDot"></span>Left middle</span>
              <span class="legendItem finger-li"><span class="legendDot"></span>Left index</span>
              <span class="legendItem finger-ri"><span class="legendDot"></span>Right index</span>
              <span class="legendItem finger-rm"><span class="legendDot"></span>Right middle</span>
              <span class="legendItem finger-rr"><span class="legendDot"></span>Right ring</span>
              <span class="legendItem finger-rp"><span class="legendDot"></span>Right pinky</span>
              <span class="legendItem finger-th"><span class="legendDot"></span>Thumbs</span>
            </div>
            <div class="small muted">Home row: rest fingers on A S D F + J K L ; (bumps on F/J).</div>
          </div>
          <div id="keyboard2" class="keyboard" aria-label="Keyboard"></div>
        </div>

        <div class="scoreRow">
          <div class="statBox"><div class="k">Time</div><div class="v" id="tTime">‚Äî</div></div>
          <div class="statBox"><div class="k">KPM</div><div class="v" id="tKpm">‚Äî</div></div>
          <div class="statBox"><div class="k">Correct</div><div class="v" id="tCorrect">0</div></div>
          <div class="statBox"><div class="k">Wrong</div><div class="v" id="tWrong">0</div></div>
        </div>

        <div class="row gap">
          <label class="field">
            <span>Length</span>
            <input id="tLen" type="number" min="10" max="300" value="60" />
          </label>
          <label class="field">
            <span>Run timer</span>
            <select id="typingTimerToggle">
              <option value="on">Enabled</option>
              <option value="off">Disabled</option>
            </select>
          </label>
          <label class="field">
            <span>Timer (sec)</span>
            <input id="tTimer" type="number" min="10" max="600" value="60" />
          </label>
        </div>
      </div>
    </section>


    <section class="card hidden" id="word">
      <div class="row">
        <h2 class="section-title">Practice: Words</h2>
        <div class="row gap">
          <button class="btn" data-nav="home">Home</button>
          <button class="btn" id="btnWordStart">Start</button>
          <button class="btn" id="btnWordPause" disabled>Pause</button>
          <button class="btn" id="btnWordStop" disabled>Stop</button>
        </div>
      </div>

      <div class="typingPanel">
        <div class="typingLine" id="wordTarget">‚Äî</div>
        <div class="small muted wordMeta hidden" id="wordDisplay"></div>
        <div class="small muted wordMeta hidden" id="wordMeaning"></div>
        <div class="typingLine typed inputDisplay" id="wordTyped"></div>
        <input class="typingLine typed input typingInputField" id="wordInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Type the word..." />
        <div class="small muted" id="wordHint">Type the word in the text box. Mistakes highlight red on the target line; fix them to advance.</div>

        <div class="kbdWrap kbdStartHidden" id="wordKeyboardWrap">
          <div class="kbdHeader">
            <div>
              <div class="kbdTitle">On-screen keyboard</div>
              <div class="small muted">Highlights the next key you need.</div>
            </div>
            <button class="btn smallBtn" data-nav="settings">Edit map</button>
          </div>
          <div class="kbdLegend" data-finger-guide>
            <div class="kbdLegendTitle">Finger guide</div>
            <div class="kbdLegendItems">
              <span class="legendItem finger-lp"><span class="legendDot"></span>Left pinky</span>
              <span class="legendItem finger-lr"><span class="legendDot"></span>Left ring</span>
              <span class="legendItem finger-lm"><span class="legendDot"></span>Left middle</span>
              <span class="legendItem finger-li"><span class="legendDot"></span>Left index</span>
              <span class="legendItem finger-ri"><span class="legendDot"></span>Right index</span>
              <span class="legendItem finger-rm"><span class="legendDot"></span>Right middle</span>
              <span class="legendItem finger-rr"><span class="legendDot"></span>Right ring</span>
              <span class="legendItem finger-rp"><span class="legendDot"></span>Right pinky</span>
              <span class="legendItem finger-th"><span class="legendDot"></span>Thumbs</span>
            </div>
            <div class="small muted">Home row: rest fingers on A S D F + J K L ; (bumps on F/J).</div>
          </div>
          <div id="keyboardWord" class="keyboard" aria-label="Keyboard"></div>
        </div>

        <div class="scoreRow">
          <div class="statBox"><div class="k">Words</div><div class="v" id="wDone">0</div></div>
          <div class="statBox"><div class="k">Correct keys</div><div class="v" id="wCorrect">0</div></div>
          <div class="statBox"><div class="k">Wrong keys</div><div class="v" id="wWrong">0</div></div>
          <div class="statBox"><div class="k">Accuracy</div><div class="v" id="wAcc">‚Äî</div></div>
        </div>

        <div class="row gap">
          <label class="field">
            <span>Word list</span>
            <select id="wordListSelect">
              <option value="basic">Basic (built-in)</option>
              <option value="classVocab">Class Vocab</option>
              <option value="all">All enabled kana (random)</option>
              <option value="custom">Custom set</option>
            </select>
          </label>
          <label class="field">
            <span>Max length</span>
            <input id="wordMaxLen" type="number" min="2" max="12" value="6" />
          </label>
        </div>

        <div class="row gap">
          <label class="field">
            <span>Word sets</span>
            <select id="wordSetSelect"></select>
          </label>
          <label class="field grow">
            <span>Set name</span>
            <input id="wordSetName" type="text" placeholder="Custom set name" />
          </label>
          <div class="field wordSetActions">
            <span>Actions</span>
            <div class="row gap">
              <button class="btn smallBtn" id="btnWordSetAdd" type="button">Add new set</button>
              <button class="btn smallBtn" id="btnWordSetDelete" type="button">Delete set</button>
            </div>
          </div>
        </div>
        <label class="field grow">
          <span>Words (one per line)</span>
          <textarea id="wordSetWords" rows="6" placeholder="„ÅÇ„ÇÅ&#10;„Åï„Åè„Çâ&#10;„ÇÑ„Åï„ÅÑ"></textarea>
          <div class="row gap">
            <button class="btn smallBtn" id="btnWordSetAddLine" type="button">Add word line</button>
          </div>
        </label>
      </div>
    </section>

    <section class="card hidden" id="sentence">
      <div class="row">
        <h2 class="section-title">Practice: Sentences</h2>
        <div class="row gap">
          <button class="btn" data-nav="home">Home</button>
          <button class="btn" id="btnSentenceStart">Start</button>
          <button class="btn" id="btnSentencePause" disabled>Pause</button>
          <button class="btn" id="btnSentenceStop" disabled>Stop</button>
        </div>
      </div>

      <div class="typingPanel">
        <div class="typingLine" id="sentenceTarget">‚Äî</div>
        <div class="typingLine typed inputDisplay" id="sentenceTyped"></div>
        <input class="typingLine typed input typingInputField" id="sentenceInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Type the sentence..." />
        <div class="small muted" id="sentenceHint">Type the sentence in the text box. Spaces are optional (you can press Space to match a space). Mistakes highlight red on the passage; fix them to advance.</div>

        <div class="kbdWrap kbdStartHidden" id="sentenceKeyboardWrap">
          <div class="kbdHeader">
            <div>
              <div class="kbdTitle">On-screen keyboard</div>
              <div class="small muted">Highlights the next key you need.</div>
            </div>
            <button class="btn smallBtn" data-nav="settings">Edit map</button>
          </div>
          <div class="kbdLegend" data-finger-guide>
            <div class="kbdLegendTitle">Finger guide</div>
            <div class="kbdLegendItems">
              <span class="legendItem finger-lp"><span class="legendDot"></span>Left pinky</span>
              <span class="legendItem finger-lr"><span class="legendDot"></span>Left ring</span>
              <span class="legendItem finger-lm"><span class="legendDot"></span>Left middle</span>
              <span class="legendItem finger-li"><span class="legendDot"></span>Left index</span>
              <span class="legendItem finger-ri"><span class="legendDot"></span>Right index</span>
              <span class="legendItem finger-rm"><span class="legendDot"></span>Right middle</span>
              <span class="legendItem finger-rr"><span class="legendDot"></span>Right ring</span>
              <span class="legendItem finger-rp"><span class="legendDot"></span>Right pinky</span>
              <span class="legendItem finger-th"><span class="legendDot"></span>Thumbs</span>
            </div>
            <div class="small muted">Home row: rest fingers on A S D F + J K L ; (bumps on F/J).</div>
          </div>
          <div id="keyboardSentence" class="keyboard" aria-label="Keyboard"></div>
        </div>

        <div class="scoreRow">
          <div class="statBox"><div class="k">Sentences</div><div class="v" id="sDone">0</div></div>
          <div class="statBox"><div class="k">Correct keys</div><div class="v" id="sCorrect">0</div></div>
          <div class="statBox"><div class="k">Wrong keys</div><div class="v" id="sWrong">0</div></div>
          <div class="statBox"><div class="k">Accuracy</div><div class="v" id="sAcc">‚Äî</div></div>
        </div>

        <div class="row gap">
          <label class="field">
            <span>Sentence set</span>
            <select id="sentenceListSelect">
              <option value="basic">Basic (built-in)</option>
            </select>
          </label>
        </div>
      </div>
    </section>


    <section class="card hidden" id="stats">
      <div class="row">
        <h2 class="section-title">Stats</h2>
        <div class="row gap">
          <button class="btn" data-nav="home">Home</button>
          <button class="btn" id="btnResetStats">Reset stats</button>
        </div>
      </div>

      <div class="grid3" id="statsGrid"></div>

      <div class="cardInner">
        <h3 class="section-title">Kana accuracy heatmap</h3>
        <div class="small muted">This shows which kana you miss the most. Aim to make the whole grid boring üòÑ</div>
        <div id="heatmap" class="heatmap"></div>
      </div>
    </section>

    <section class="card hidden" id="settings">
      <div class="row">
        <h2 class="section-title">Settings / Keyboard Map</h2>
        <div class="row gap">
          <button class="btn" data-nav="home">Home</button>
          <button class="btn" id="btnExport">Export map</button>
          <label class="btn fileBtn">
            Import map
            <input id="importFile" type="file" accept="application/json" />
          </label>
          <button class="btn danger" id="btnResetMap">Reset map</button>
        </div>
      </div>

      <div class="grid2">
        <label class="field">
          <span>Default layout</span>
          <select id="layoutSelect">
            <option value="jis">Japanese JIS (recommended)</option>
            <option value="us">US keyboard (basic)</option>
          </select>
        </label>

        <label class="field">
          <span>Input mode</span>
          <select id="inputModeSelect">
            <option value="mapped">Mapped key codes (use app keyboard map)</option>
            <option value="native">Native keyboard input (use your OS/IME)</option>
          </select>
        </label>

        <label class="field">
          <span>On-screen keyboard</span>
          <select id="keyboardToggle">
            <option value="on">Show</option>
            <option value="off">Hide</option>
          </select>
        </label>

        <label class="field">
          <span>Background Video</span>
          <select id="backgroundVideoSelect">
            <option value="off">Off</option>
            <option value="on">On</option>
          </select>
          <span class="small muted" id="backgroundVideoNote">Sakura video backdrop behind the UI.</span>
        </label>

        <label class="field">
          <span>Keyboard style</span>
          <select id="keyboardLayoutSelect">
            <option value="windows">Windows (main)</option>
            <option value="mac">Mac (main)</option>
            <option value="windows-numpad">Windows + number pad</option>
            <option value="mac-numpad">Mac + number pad</option>
          </select>
        </label>

        <label class="field">
          <span>Finger guide</span>
          <select id="fingerGuideToggle">
            <option value="on">Show</option>
            <option value="off">Hide</option>
          </select>
        </label>
      </div>

      <div class="cardInner">
        <h3 class="section-title">Edit key ‚Üí kana mapping</h3>
        <div class="small muted">
          Click any kana cell to edit. Values should be single kana like <code>„ÅÇ</code> (you can also use small kana like <code>„ÇÉ</code>).
        </div>
        <div id="mapTable" class="mapTable"></div>
      </div>

      <div class="cardInner">
        <h3 class="section-title">What to practice</h3>
        <div class="small muted">Toggle sets to focus on. (These determine what gets picked as the target.)</div>
        <div id="sets" class="sets"></div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div>Tip: This is a PWA ‚Äî add it to your home screen for a full-screen app feel.</div>
  </footer>

  <script src="app.js"></script>
</body>
</html>
